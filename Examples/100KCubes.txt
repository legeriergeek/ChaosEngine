//100K Cubes - 2025 legeriergeek
//Spawns 100k cubes by default. Warning: gets pretty laggy. You can reduce the number of cubes by changing the "cubeNumber" variable.

package fr.chaos.engine.core;

import static org.lwjgl.opengl.GL11.GL_COLOR_BUFFER_BIT;
import static org.lwjgl.opengl.GL11.GL_DEPTH_BUFFER_BIT;
import static org.lwjgl.opengl.GL11.GL_DEPTH_TEST;
import static org.lwjgl.opengl.GL11.glClear;
import static org.lwjgl.opengl.GL11.glEnable;

import static org.lwjgl.glfw.GLFW.*;

import org.joml.Vector3f;

import fr.chaos.engine.graphics.Mesh;
import fr.chaos.engine.graphics.Camera;
import fr.chaos.engine.graphics.Texture;
import java.util.ArrayList;
import java.util.Random;

public class Renderer{
    public static ShaderProgram shader;
    public static ArrayList<Mesh> cubes = new ArrayList<>();
    public static Camera camera;
    public static Texture texture1;
    public static int cubeNumber = 100000;
    public static void init(){    
        shader = new ShaderProgram("vertex.glsl", "fragment.glsl");
        texture1 = new Texture("unportalable.jpg");
        Random r = new Random();
        for(int i = 0; i < cubeNumber; i++){
            cubes.add(new Mesh(Mesh.cubeVertices, new Vector3f(-5 + r.nextFloat() * (5 - -5), -2 + r.nextFloat() * (5 - -5), -5 + r.nextFloat() * (5 - -5)), new Vector3f(0f, 0f, 0f), new Vector3f(0.5f, 0.5f, 0.5f), texture1));
        }
        camera = new Camera(new Vector3f(0f, 0f, 3), new Vector3f(0f,0f,0f), 70, (float) Engine.windowWidth/Engine.windowHeight, 0.1f, 100f);
    }
    
    public static void render(){
        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
        glEnable(GL_DEPTH_TEST);
        shader.use();
        texture1.bind();
        shader.setUniform("view", camera.getViewMatrix());
        shader.setUniform("projection", camera.getProjectionMatrix());
        for(int i = 0; i < cubeNumber; i++){
            shader.setUniform("model", cubes.get(i).getModelMatrix());
            cubes.get(i).draw();
        }
    }

    public static void update(long window) {
        float deltaTime = 0.016f;
        for(int i = 0; i < cubeNumber; i++){
            Mesh cube = cubes.get(i);
            cube.rotation = new Vector3f(cube.rotation.x + 1f * deltaTime, cube.rotation.y + 1f * deltaTime, cube.rotation.z + 1f * deltaTime);
        }
        float speed = 0.05f;
        float yaw = camera.getRotation().y;

        float forwardX = (float) Math.sin(yaw);
        float forwardZ = (float) -Math.cos(yaw);
        float rightX = (float) Math.cos(yaw);
        float rightZ = (float) Math.sin(yaw);

        Vector3f pos = camera.getPosition();

        if (glfwGetKey(window, GLFW_KEY_W) == GLFW_PRESS) {
            pos.x -= forwardX * speed;
            pos.z += forwardZ * speed;
        }
        if (glfwGetKey(window, GLFW_KEY_S) == GLFW_PRESS) {
            pos.x += forwardX * speed;
            pos.z -= forwardZ * speed;
        }
        if (glfwGetKey(window, GLFW_KEY_A) == GLFW_PRESS) {
            pos.x -= rightX * speed;
            pos.z -= rightZ * speed;
        }
        if (glfwGetKey(window, GLFW_KEY_D) == GLFW_PRESS) {
            pos.x += rightX * speed;
            pos.z += rightZ * speed;
        }

        if (glfwGetKey(window, GLFW_KEY_UP) == GLFW_PRESS) {
            pos.y += speed;
        }
        if (glfwGetKey(window, GLFW_KEY_DOWN) == GLFW_PRESS) {
            pos.y -= speed;
        }

        if (glfwGetKey(window, GLFW_KEY_RIGHT) == GLFW_PRESS) {
            camera.setRotation(new Vector3f(camera.getRotation().x, yaw - 0.5f, camera.getRotation().z));
        }
        if (glfwGetKey(window, GLFW_KEY_LEFT) == GLFW_PRESS) {
            camera.setRotation(new Vector3f(camera.getRotation().x, yaw + 0.5f, camera.getRotation().z));
        }
    }

}
